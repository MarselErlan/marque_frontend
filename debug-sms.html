<!DOCTYPE html>
<html>
<head>
    <title>Debug SMS Issue</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="p-8 bg-gray-100">
    <div class="max-w-md mx-auto bg-white rounded-lg shadow-md p-6">
        <h1 class="text-2xl font-bold mb-4">Debug SMS Issue</h1>
        
        <div class="mb-4">
            <label class="block mb-2">Country Code:</label>
            <select id="countryCode" class="w-full p-2 border rounded">
                <option value="+1">üá∫üá∏ +1 (US)</option>
                <option value="+996">üá∞üá¨ +996 (KG)</option>
            </select>
        </div>
        
        <div class="mb-4">
            <label class="block mb-2">Phone Number:</label>
            <input type="tel" id="phoneNumber" placeholder="3128059851" class="w-full p-2 border rounded">
        </div>
        
        <div class="mb-4">
            <strong>Full Number: </strong><span id="fullNumber">+1</span>
        </div>
        
        <button onclick="testSMS()" class="w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600">
            Test SMS API
        </button>
        
        <div id="result" class="mt-4 p-4 bg-gray-100 rounded hidden"></div>
    </div>

    <script>
        const countryCodeSelect = document.getElementById('countryCode');
        const phoneNumberInput = document.getElementById('phoneNumber');
        const fullNumberSpan = document.getElementById('fullNumber');
        const resultDiv = document.getElementById('result');
        
        function updateFullNumber() {
            const countryCode = countryCodeSelect.value;
            const phoneNumber = phoneNumberInput.value.replace(/[-\s]/g, '');
            const fullNumber = countryCode + phoneNumber;
            fullNumberSpan.textContent = fullNumber;
        }
        
        countryCodeSelect.addEventListener('change', updateFullNumber);
        phoneNumberInput.addEventListener('input', updateFullNumber);
        
        async function testSMS() {
            const countryCode = countryCodeSelect.value;
            const phoneNumber = phoneNumberInput.value.replace(/[-\s]/g, '');
            const fullPhoneNumber = countryCode + phoneNumber;
            
            console.log('Country Code:', countryCode);
            console.log('Phone Number:', phoneNumber);
            console.log('Full Phone Number:', fullPhoneNumber);
            
            resultDiv.className = 'mt-4 p-4 bg-yellow-100 rounded';
            resultDiv.textContent = 'Testing...';
            resultDiv.classList.remove('hidden');
            
            try {
                const response = await fetch('https://marquebackend-production.up.railway.app/api/v1/auth/send-verification', {
                    method: 'POST',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                    },
                    body: JSON.stringify({
                        phone: fullPhoneNumber
                    })
                });
                
                console.log('Response Status:', response.status);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('Success:', data);
                    
                    resultDiv.className = 'mt-4 p-4 bg-green-100 rounded';
                    resultDiv.innerHTML = `
                        <h3 class="font-bold text-green-800">‚úÖ Success!</h3>
                        <p><strong>Phone:</strong> ${data.data.phone}</p>
                        <p><strong>Market:</strong> ${data.data.market}</p>
                        <p><strong>Provider:</strong> ${data.data.sms_provider}</p>
                        <p><strong>Message:</strong> ${data.message}</p>
                    `;
                } else {
                    const errorText = await response.text();
                    console.error('Error:', errorText);
                    
                    resultDiv.className = 'mt-4 p-4 bg-red-100 rounded';
                    resultDiv.innerHTML = `
                        <h3 class="font-bold text-red-800">‚ùå Error ${response.status}</h3>
                        <p>${errorText}</p>
                    `;
                }
            } catch (error) {
                console.error('Network Error:', error);
                
                resultDiv.className = 'mt-4 p-4 bg-red-100 rounded';
                resultDiv.innerHTML = `
                    <h3 class="font-bold text-red-800">‚ùå Network Error</h3>
                    <p>${error.message}</p>
                    <p>This could be a CORS issue or network problem.</p>
                `;
            }
        }
        
        // Initialize
        updateFullNumber();
    </script>
</body>
</html>
